import React, { useState, useEffect, useRef } from 'react';\nimport { View, Text, StyleSheet, TouchableOpacity, ScrollView, TextInput, FlatList } from 'react-native';\nimport { websocketService } from '../services/websocket';\n\ninterface AdminMessage {\n  id: string;\n  senderId: string;\n  receiverId: string;\n  message: string;\n  timestamp: string;\n  senderName?: string;\n}\n\ninterface AdminChatScreenProps {\n  currentAdminId: string;\n  adminToken: string;\n  onClose: () => void;\n}\n\nexport const AdminChatScreen: React.FC<AdminChatScreenProps> = ({\n  currentAdminId,\n  adminToken,\n  onClose\n}) => {\n  const [messages, setMessages] = useState<AdminMessage[]>([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [selectedAdmin, setSelectedAdmin] = useState<string | null>(null);\n  const [adminList] = useState([\n    { id: 'admin_1', name: 'Trade Admin 1', role: 'Trade Admin' },\n    { id: 'admin_2', name: 'Rate Admin 1', role: 'Rate Admin' },\n    { id: 'super_admin', name: 'Super Admin', role: 'Super Admin' }\n  ]);\n  const [isConnected, setIsConnected] = useState(false);\n  const scrollViewRef = useRef<ScrollView>(null);\n\n  useEffect(() => {\n    // Initialize WebSocket for admin\n    websocketService.connect(adminToken, 'admin');\n\n    // Check connection status\n    const checkConnection = () => {\n      setIsConnected(websocketService.isConnected());\n    };\n    const connectionInterval = setInterval(checkConnection, 1000);\n\n    // Listen for new admin messages\n    const handleNewAdminMessage = (data: any) => {\n      const newMsg: AdminMessage = {\n        id: data.message.id,\n        senderId: data.message.senderId,\n        receiverId: data.message.receiverId,\n        message: data.message.message,\n        timestamp: data.message.timestamp,\n        senderName: adminList.find(a => a.id === data.message.senderId)?.name || 'Admin'\n      };\n      setMessages(prev => [...prev, newMsg]);\n    };\n\n    const handleMessageSent = (data: any) => {\n      const sentMsg: AdminMessage = {\n        id: data.message.id,\n        senderId: data.message.senderId,\n        receiverId: data.message.receiverId,\n        message: data.message.message,\n        timestamp: data.message.timestamp,\n        senderName: 'You'\n      };\n      setMessages(prev => [...prev, sentMsg]);\n    };\n\n    websocketService.onMessage('new_admin_message', handleNewAdminMessage);\n    websocketService.onMessage('admin_message_sent', handleMessageSent);\n\n    return () => {\n      clearInterval(connectionInterval);\n      websocketService.offMessage('new_admin_message', handleNewAdminMessage);\n      websocketService.offMessage('admin_message_sent', handleMessageSent);\n    };\n  }, [adminToken, adminList]);\n\n  useEffect(() => {\n    // Auto-scroll to bottom\n    setTimeout(() => {\n      scrollViewRef.current?.scrollToEnd({ animated: true });\n    }, 100);\n  }, [messages]);\n\n  const sendMessage = () => {\n    if (!newMessage.trim() || !selectedAdmin) return;\n\n    websocketService.sendAdminMessage(selectedAdmin, newMessage);\n    setNewMessage('');\n  };\n\n  const filteredMessages = selectedAdmin \n    ? messages.filter(msg => \n        (msg.senderId === currentAdminId && msg.receiverId === selectedAdmin) ||\n        (msg.senderId === selectedAdmin && msg.receiverId === currentAdminId)\n      )\n    : [];\n\n  return (\n    <View style={styles.container}>\n      {/* Header */}\n      <View style={styles.header}>\n        <TouchableOpacity onPress={onClose} style={styles.backButton}>\n          <Text style={styles.backText}>‚Üê</Text>\n        </TouchableOpacity>\n        <View style={styles.headerInfo}>\n          <Text style={styles.headerTitle}>Admin Chat</Text>\n          <Text style={[styles.connectionStatus, isConnected ? styles.connected : styles.disconnected]}>\n            {isConnected ? 'üü¢ Live' : 'üî¥ Offline'}\n          </Text>\n        </View>\n      </View>\n\n      <View style={styles.content}>\n        {/* Admin List */}\n        <View style={styles.adminList}>\n          <Text style={styles.sectionTitle}>Select Admin</Text>\n          {adminList.filter(admin => admin.id !== currentAdminId).map(admin => (\n            <TouchableOpacity\n              key={admin.id}\n              style={[styles.adminItem, selectedAdmin === admin.id && styles.selectedAdmin]}\n              onPress={() => setSelectedAdmin(admin.id)}\n            >\n              <Text style={styles.adminName}>{admin.name}</Text>\n              <Text style={styles.adminRole}>{admin.role}</Text>\n            </TouchableOpacity>\n          ))}\n        </View>\n\n        {/* Chat Area */}\n        {selectedAdmin ? (\n          <View style={styles.chatArea}>\n            <Text style={styles.chatTitle}>\n              Chat with {adminList.find(a => a.id === selectedAdmin)?.name}\n            </Text>\n            \n            <ScrollView \n              ref={scrollViewRef}\n              style={styles.messagesContainer}\n              showsVerticalScrollIndicator={false}\n            >\n              {filteredMessages.map(message => (\n                <View \n                  key={message.id}\n                  style={[\n                    styles.messageContainer,\n                    message.senderId === currentAdminId ? styles.sentMessage : styles.receivedMessage\n                  ]}\n                >\n                  <View style={[\n                    styles.messageBubble,\n                    message.senderId === currentAdminId ? styles.sentBubble : styles.receivedBubble\n                  ]}>\n                    <Text style={[\n                      styles.messageText,\n                      message.senderId === currentAdminId ? styles.sentText : styles.receivedText\n                    ]}>\n                      {message.message}\n                    </Text>\n                    <Text style={styles.messageTime}>\n                      {new Date(message.timestamp).toLocaleTimeString()}\n                    </Text>\n                  </View>\n                </View>\n              ))}\n            </ScrollView>\n\n            {/* Input */}\n            <View style={styles.inputContainer}>\n              <TextInput\n                style={styles.textInput}\n                value={newMessage}\n                onChangeText={setNewMessage}\n                placeholder=\"Type your message...\"\n                multiline\n                maxLength={500}\n              />\n              <TouchableOpacity \n                style={[styles.sendButton, !isConnected && styles.disconnectedButton]}\n                onPress={sendMessage}\n                disabled={!newMessage.trim() || !isConnected}\n              >\n                <Text style={styles.sendText}>Send</Text>\n              </TouchableOpacity>\n            </View>\n          </View>\n        ) : (\n          <View style={styles.noSelection}>\n            <Text style={styles.noSelectionText}>Select an admin to start chatting</Text>\n          </View>\n        )}\n      </View>\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#f8fafc',\n  },\n  header: {\n    backgroundColor: '#1a365d',\n    flexDirection: 'row',\n    alignItems: 'center',\n    paddingTop: 50,\n    paddingBottom: 16,\n    paddingHorizontal: 16,\n  },\n  backButton: {\n    padding: 8,\n  },\n  backText: {\n    color: 'white',\n    fontSize: 24,\n    fontWeight: 'bold',\n  },\n  headerInfo: {\n    flex: 1,\n    marginLeft: 12,\n  },\n  headerTitle: {\n    color: 'white',\n    fontSize: 18,\n    fontWeight: 'bold',\n  },\n  connectionStatus: {\n    fontSize: 12,\n    fontWeight: 'bold',\n    marginTop: 2,\n  },\n  connected: {\n    color: '#10b981',\n  },\n  disconnected: {\n    color: '#ef4444',\n  },\n  content: {\n    flex: 1,\n    flexDirection: 'row',\n  },\n  adminList: {\n    width: 200,\n    backgroundColor: 'white',\n    borderRightWidth: 1,\n    borderRightColor: '#e2e8f0',\n    padding: 16,\n  },\n  sectionTitle: {\n    fontSize: 16,\n    fontWeight: 'bold',\n    color: '#1a365d',\n    marginBottom: 12,\n  },\n  adminItem: {\n    padding: 12,\n    borderRadius: 8,\n    marginBottom: 8,\n    backgroundColor: '#f8fafc',\n  },\n  selectedAdmin: {\n    backgroundColor: '#fef3c7',\n    borderWidth: 2,\n    borderColor: '#f59e0b',\n  },\n  adminName: {\n    fontSize: 14,\n    fontWeight: 'bold',\n    color: '#1a365d',\n  },\n  adminRole: {\n    fontSize: 12,\n    color: '#64748b',\n    marginTop: 2,\n  },\n  chatArea: {\n    flex: 1,\n    backgroundColor: 'white',\n  },\n  chatTitle: {\n    fontSize: 16,\n    fontWeight: 'bold',\n    color: '#1a365d',\n    padding: 16,\n    borderBottomWidth: 1,\n    borderBottomColor: '#e2e8f0',\n  },\n  messagesContainer: {\n    flex: 1,\n    padding: 16,\n  },\n  messageContainer: {\n    marginBottom: 12,\n  },\n  sentMessage: {\n    alignItems: 'flex-end',\n  },\n  receivedMessage: {\n    alignItems: 'flex-start',\n  },\n  messageBubble: {\n    maxWidth: '80%',\n    padding: 12,\n    borderRadius: 16,\n  },\n  sentBubble: {\n    backgroundColor: '#3b82f6',\n  },\n  receivedBubble: {\n    backgroundColor: '#e2e8f0',\n  },\n  messageText: {\n    fontSize: 16,\n    lineHeight: 20,\n  },\n  sentText: {\n    color: 'white',\n  },\n  receivedText: {\n    color: '#1a365d',\n  },\n  messageTime: {\n    fontSize: 12,\n    color: 'rgba(255,255,255,0.7)',\n    marginTop: 4,\n  },\n  inputContainer: {\n    flexDirection: 'row',\n    alignItems: 'flex-end',\n    padding: 16,\n    borderTopWidth: 1,\n    borderTopColor: '#e2e8f0',\n  },\n  textInput: {\n    flex: 1,\n    borderWidth: 1,\n    borderColor: '#d1d5db',\n    borderRadius: 20,\n    paddingHorizontal: 16,\n    paddingVertical: 12,\n    maxHeight: 100,\n    fontSize: 16,\n  },\n  sendButton: {\n    backgroundColor: '#3b82f6',\n    paddingHorizontal: 20,\n    paddingVertical: 12,\n    borderRadius: 20,\n    marginLeft: 12,\n  },\n  disconnectedButton: {\n    backgroundColor: '#6b7280',\n    opacity: 0.7,\n  },\n  sendText: {\n    color: 'white',\n    fontWeight: 'bold',\n  },\n  noSelection: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center',\n    backgroundColor: 'white',\n  },\n  noSelectionText: {\n    fontSize: 16,\n    color: '#64748b',\n  },\n});